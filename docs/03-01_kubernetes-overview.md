# 3장. 컨테이너를 다루는 표준 아키텍처, 쿠버네티스

> 3.1 쿠버네티스 이해하기
> 3.2 쿠버네티스 기본 사용법 배우기
> 3.3 쿠버네티스 연결을 담당하는 서비스
> 3.4 알아두면 쓸모 있는 쿠버네티스 오브젝트
>
> > 본 문서는 3장의 일부 내용 중 **3.1 쿠버네티스 이해하기** 중 일부를 정리한 내용입니다.



## 3.1.1 쿠버네티스 이해하기

### 컨테이너 인프라 환경

- 리눅스 운영체제의 **하나의 커널** 위에서 여러 개의 컨테이너가 **격리된 상태**로 실행되는 환경
- 각 컨테이너는 하나 이상의 목적을 가진 **독립적인 프로세스**
- **가상화 환경보다**:
  - 자원을 더 효율적으로 사용
  - 부팅·기동 단계가 적어 속도가 빠름

---

### 쿠버네티스란?

> 단순한 '컨테이너 관리 도구'가 아닌, **컨테이너 오케스트레이션을 위한 플랫폼**

- 컨테이너의 배포, 확장, 상태 관리 등을 자동으로 수행
- 서비스 간 관계를 정의하고 복잡한 운영을 단순화

---

### 오케스트레이션이란?

> 복잡한 요소들의 관계를 유기적으로 정의하고, **자동화된 방식으로 운영**하는 것

- 예: 컨테이너의 생성, 네트워크 설정, 스케일링, 롤백 등의 전 과정을 자동화
- 쿠버네티스는 이를 전담하는 **표준 솔루션** 중 하나

---

### 쿠버네티스 외의 오케스트레이션 도구들

| 도구                  | 특징                                                    |
| --------------------- | ------------------------------------------------------- |
| **Docker Swarm**      | 간편한 설치와 사용 / 기능이 적어 대규모 운영에는 부적합 |
| **Apache Mesos**      | 강력한 기능과 검증된 안정성 / 분산 시스템 연동이 필요   |
| **Nomad (HashiCorp)** | 경량화된 구성 / 단순한 오케스트레이션에 적합            |

---

### Kubernetes = K8s

- `Kubernetes`를 줄여 `K8s`라고 부름
- **현재 가장 널리 쓰이는 오케스트레이션 도구**

---

### 3.1.2 쿠버네티스 구성 방법

#### 1. 퍼블릭 클라우드 기반 (관리형 쿠버네티스)

> **클라우드 제공업체에서 관리 노드를 구성 및 운영**

- 관리 부담 ↓ / 안정성 ↑
- 대표 서비스:
  - **EKS**: Amazon Elastic Kubernetes Service
  - **AKS**: Azure Kubernetes Service
  - **GKE**: Google Kubernetes Engine

#### 2. 설치형(온프레미스 또는 VM 기반) 쿠버네티스

> 기업용 플랫폼에서 제공하는 상용 솔루션

- 예: 
  - **OpenShift** (Red Hat)
  - **Rancher** (SUSE)
- 보안·UI·운영툴 포함 (대부분 유료)

#### 3. 직접 구축하는 쿠버네티스

> 클러스터 구성 도구를 활용해 쿠버네티스를 직접 설치 및 운영

- 대표 도구:
  - **kubeadm**: 가장 기본적인 설치 도구 (온프레미스/클라우드 모두 지원)
  - **kops**: AWS 기반에 적합한 쿠버네티스 설치 도구
  - **KRIB**: Rebar 기반 자동 부트스트랩 도구

### 3.1.3 파드 배포를 중심으로 쿠버네티스 구성 요소 살펴보기

#### 구성 요소 이름 생성 규칙

- 쿠버네티스는 **동일한 구성 요소가 중복될 수 있으므로**, 이름 충돌을 방지하기 위해 **자동 생성된 해시(hash) 코드**를 이름 뒤에 붙입니다.
- 수동으로 이름을 지정할 수도 있지만, **파드는 재생성될 수 있는 특성**이 있기 때문에 자동 이름 부여가 관리에 더 유리합니다.

---

#### 쿠버네티스 주요 구성 요소

참고: 『컨테이너 인프라 환경 구축을 위한 쿠버네티스/도커』, p.129 그림 3-12 쿠버네티스트의 구성 요소간 통신

##### kubectl

- 쿠버네티스 클러스터에 **명령을 내리는 클라이언트 도구**
- 마스터 노드에 설치할 필요는 없으며, **API 서버와 통신**하여 클러스터를 조작

##### API 서버

- 클러스터의 **중심 통신 허브**
- 구성 요소 간의 모든 요청은 API 서버를 거침
- **etcd**와 상태 데이터를 주고받음

##### etcd

- 클러스터 내 **구성 요소의 상태 정보를 저장**하는 분산 Key-Value 저장소
- 쿠버네티스에서 **유일한 상태 저장소**로, 백업만 잘 되어 있으면 클러스터 복구가 가능
- 이름 의미: `etc`(리눅스 설정 디렉토리) + `distributed`(분산)

##### 컨트롤러 매니저

- 쿠버네티스 **오브젝트의 상태를 유지 및 복구**
- 다양한 컨트롤러 포함:
  - **노드 컨트롤러**: 노드 장애 시 복구 처리
  - **레플리카셋 컨트롤러**: 파드 수 유지

##### 스케줄러

- 새로운 파드를 **어느 워커 노드에 배포할지 결정**
- 노드의 상태, 리소스, 레이블 등을 고려해 **적절한 노드에 파드 할당**

---

#### 워커 노드 구성 요소

##### kubelet

- API 서버로부터 전달받은 **파드 정의(PodSpec)**를 바탕으로 파드를 실행
- **컨테이너의 상태를 지속적으로 모니터링**

##### 컨테이너 런타임 (CRI)

- **파드를 구성하는 컨테이너들을 실행**하는 역할
- 다양한 런타임 지원 (예: containerd, CRI-O 등)
- **CRI (Container Runtime Interface)**는 컨테이너 실행을 위한 표준 인터페이스

##### 파드(Pod)

- 쿠버네티스의 **가장 작은 배포 단위**
- 한 개 이상의 컨테이너로 구성되며, **단일 목적을 수행**
- 예: 웹 서버, 로그 수집기 등
- 파드는 일시적이며 **언제든지 종료될 수 있음**

---

#### 선택적 구성 요소

##### 네트워크 플러그인 (CNI)

- 쿠버네티스 클러스터의 통신을 위한 **네트워크 구성**
- **CNI (Container Network Interface)**는 네트워크 확장성과 표준화를 위한 플러그인 시스템

##### CoreDNS

- 클러스터 내부 DNS 서버
- **빠르고 유연한 네이티브 DNS 서비스**로, 클라우드 네이티브 컴퓨팅 재단(CNCF)에서 보증

---

#### 사용자가 배포된 파드에 접속할 때

1. **kube-proxy**  
   - 파드가 위치한 워커 노드에 설치되어 **네트워크 경로를 설정**
   - 내부적으로 `iptables` 및 `br_netfilter`를 통해 패킷을 라우팅

2. **파드 접속**  
   - 사용자는 파드가 어느 노드에 있는지 몰라도 됨
   - 요청은 적절한 파드로 전달되고 결과를 반환받음